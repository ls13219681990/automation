<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>html导出生成word文档</title>
    <link rel="stylesheet" href="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/layui.css"
          media="all">
    <style>
        .sm10 {
            width: 100%;
            height: 100%;
        }

        .sm7 {
            width: 83.33333333%;
            height: 100%;
        }

        .sm3 {
            width: 16.66666667%;
            height: 100%;
        }
    </style>
    <link id="layuicss-layer" rel="stylesheet"
          href="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/layer.css" media="all">
</head>

<body>
<input type="button" value="导出word">
<div class="sm10">
    <div type="hidden" id="tree"></div>
    <table b="" width="100%">
        <tr>
            <td class="sm7" valign="top" align="center">
                <div id="word">
                    <div id="content">
                        <div width="600" align="center"><font size="3" color="red">管线沉降(右线)</font><font
                                size="3">检测数据</font></div>
                        <table width="600" border="1">
                            <tbody>
                            <tr align="center">
                                <td colspan="2">工程名称</td>
                                <td colspan="6">测试工点1</td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">施工单位</td>
                                <td colspan="2">成都施工</td>
                                <td colspan="2">检测项目</td>
                                <td colspan="2"><font style="color:red;">管线沉降(右线)</font></td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">监理单位</td>
                                <td colspan="2">成都监理</td>
                                <td colspan="2">上次观测日期</td>
                                <td colspan="2">null</td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">仪器规格</td>
                                <td colspan="2"></td>
                                <td colspan="2">本次观测日期</td>
                                <td colspan="2">2019-11-14 15:45:42</td>
                            </tr>
                            <tr align="center">
                                <td rowspan="8">检测项目</td>
                                <td rowspan="2">测点编号</td>
                                <td>初始高程</td>
                                <td>上次高程</td>
                                <td>本次高程</td>
                                <td>单次变形量</td>
                                <td>累计值</td>
                                <td rowspan="8">初测日期</td>
                            </tr>
                            <tr align="center">
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                            </tr>
                            <tr align="center">
                                <td>XX</td>
                                <td></td>
                                <td>123</td>
                                <td>113</td>
                                <td>-10</td>
                                <td>-10</td>
                            </tr>
                            <tr align="center">
                                <td>1111</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td>2</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td>4</td>
                                <td></td>
                                <td>155</td>
                                <td>113</td>
                                <td>-42</td>
                                <td>-42</td>
                            </tr>
                            <tr align="center">
                                <td>10</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td>11</td>
                                <td></td>
                                <td>119</td>
                                <td>113</td>
                                <td>-6</td>
                                <td>-6</td>
                            </tr>
                            <tr align="center">
                                <td colspan="5">最大值</td>
                                <td><font style="color:red;">-42</font></td>
                                <td><font style="color:red;">-42</font></td>
                                <td></td>
                            </tr>
                            <tr align="center">
                                <td colspan="8">备注：1.“+”值表示测点隆起，“-”值表示测点下沉，“/”表示测点被挡或破坏。</td>
                            </tr>
                            <tr align="center">
                                <td colspan="8"><input type="file" name="file" id="file" accept="image/*"
                                                       onchange="imgChange(this);"> <!--文件上传选择按钮--> <img id="imghead"
                                                                                                         src="C:\Users\86132\Desktop\u=1042594109,1865981201&fm=26&gp=0.jpg">
                                    <!--图片显示位置--> </td>
                            </tr>
                            </tbody>
                        </table>
                        <div width="600" align="center"><font size="3" color="red">管线沉降(左线)</font><font
                                size="3">检测数据</font></div>
                        <table width="900" border="1">
                            <tbody>
                            <tr align="center">
                                <td colspan="2">工程名称</td>
                                <td colspan="6">测试工点1</td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">施工单位</td>
                                <td colspan="2">成都施工</td>
                                <td colspan="2">检测项目</td>
                                <td colspan="2"><font style="color:red;">管线沉降(左线)</font></td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">监理单位</td>
                                <td colspan="2">成都监理</td>
                                <td colspan="2">上次观测日期</td>
                                <td colspan="2">null</td>
                            </tr>
                            <tr align="center">
                                <td colspan="2">仪器规格</td>
                                <td colspan="2"></td>
                                <td colspan="2">本次观测日期</td>
                                <td colspan="2">2019-11-14 15:45:42</td>
                            </tr>
                            <tr align="center">
                                <td rowspan="7">检测项目</td>
                                <td rowspan="2">测点编号</td>
                                <td>初始高程</td>
                                <td>上次高程</td>
                                <td>本次高程</td>
                                <td>单次变形量</td>
                                <td>累计值</td>
                                <td rowspan="7">初测日期</td>
                            </tr>
                            <tr align="center">
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                                <td>(mm)</td>
                            </tr>
                            <tr align="center">
                                <td>CSCD1</td>
                                <td></td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>-2</td>
                            </tr>
                            <tr align="center">
                                <td>XXXX</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td>CX</td>
                                <td></td>
                                <td>144</td>
                                <td>113</td>
                                <td>-31</td>
                                <td>-31</td>
                            </tr>
                            <tr align="center">
                                <td>3</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td>5</td>
                                <td></td>
                                <td>111</td>
                                <td>113</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr align="center">
                                <td colspan="5">最大值</td>
                                <td><font style="color:red;">-31</font></td>
                                <td><font style="color:red;">-31</font></td>
                                <td></td>
                            </tr>
                            <tr align="center">
                                <td colspan="8">备注：1.“+”值表示测点隆起，“-”值表示测点下沉，“/”表示测点被挡或破坏。</td>
                            </tr>
                            <tr align="center">
                                <td colspan="8"><input type="file" name="file" id="file" accept="image/*"
                                                       onchange="imgChange(this);"> <!--文件上传选择按钮--> <img id="imghead"
                                                                                                         src="C:\Users\86132\Desktop\u=1042594109,1865981201&fm=26&gp=0.jpg">
                                    <!--图片显示位置--> </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </td>
        </tr>
        </tbody></table>


</div>


<script src="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/jquery_002.js"></script>
<script src="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/layui.js" charset="utf-8"></script>
<script src="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/fileSaver.js"
        charset="utf-8"></script>
<script src="html%E5%AF%BC%E5%87%BA%E7%94%9F%E6%88%90word%E6%96%87%E6%A1%A3_files/jquery.js" charset="utf-8"></script>

<script>

    var treeData; //存子窗口传回来的数据
    var list = new Array();


    // 选择图片显示
    function imgChange(obj) {
        //获取点击的文本框
        var file = document.getElementById("file");
        var imgUrl = window.URL.createObjectURL(file.files[0]);
        var img = document.getElementById('imghead');
        img.setAttribute('src', imgUrl); // 修改img标签src属性值
    };


    //拿到子窗口中传回的数据
    function getChildrenData(data) {
        if (list.length > 0) {
            list.splice(0, list.length);
        }

        for (var i = 0; i < data.length; i++) {
            var line = data[i];
            for (var j = 0; j < line.children.length; j++) {
                var bidSection = line.children;
                for (var k = 0; k < bidSection[j].children.length; k++) {
                    var workSpot = bidSection[j].children;
                    for (var m = 0; m < workSpot[k].children.length; m++) {
                        list.push(workSpot[k].children[m].title);
                    }
                }
            }
            console.log('处理完成')
        }
        $.ajax({
            url: "/system/report/getData?list=" + list,
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (netty) {
                if (netty.code == 200) {
                    map = netty.data;
                    for (var key in map) {
                        var title = key;
                        var mapData = map[key];
                        var row = 2 + mapData.measuringSpotData.length;
                        var list = mapData.measuringSpotData;
                        var tableData = '';
                        var deformationAmountMaxValue = new Array();//变形量最大值
                        var cumulativeMaxValue = new Array(); //累计值最大值

                        var tatule = '<div width="600" align="center"><font size="3"   color="red">' + mapData.measuringSpotType + '</font><font size="3">检测数据</font></div>'

                        /*var title = '<div ><font style="color:red;>'+mapData.measuringSpotType+'</font>检测数据-</div>'*/
                        var tableView = tatule + ('<table border="1" width="900"><tr align="center"><td colspan="2">工程名称</td><td colspan="6">' + mapData.projectName + '</td></tr>'
                            + '<tr align="center"><td colspan="2">施工单位</td><td colspan="2">' + mapData.constructionCompany + '</td><td colspan="2">检测项目</td><td colspan="2"><font style="color:red;">' + mapData.measuringSpotType + '</font></td></tr>'
                            + '<tr align="center"><td colspan="2">监理单位</td><td colspan="2">' + mapData.supervisorCompany + '</td><td colspan="2">上次观测日期</td><td colspan="2">' + mapData.lastTimeDate + '</td> </tr>'
                            + '<tr align="center"><td colspan="2">仪器规格</td><td colspan="2">' + mapData.instrumentSpecifications + '</td> <td colspan="2">本次观测日期</td><td colspan="2">' + mapData.thisTimeDate + '</td></tr>'
                            + '<tr align="center"> <td rowspan=' + row + '>检测项目</td> <td rowspan="2">测点编号</td><td >初始高程</td><td>上次高程</td><td>本次高程</td><td >单次变形量</td><td>累计值</td>  <td rowspan=' + row + '>初测日期</td></tr>'
                            + '<tr align="center"><td>(mm)</td><td>(mm)</td><td>(mm)</td><td>(mm)</td><td>(mm)</td></tr>'
                        )

                        for (var i = 0; i < list.length; i++) {
                            tableData += '<tr align="center"><td>' + list[i].measuringSpotSensorNo + '</td><td>' + list[i].measuringSpotOriginalValue + '</td><td>' + list[i].measuringSpotSensorLastTimeValue + '</td><td>' + list[i].measuringSpotValue + '</td><td>' + list[i].measuringSpotDifference + '</td><td>' + list[i].measuringSpotAccumulationValue + '</td> </tr>';
                            deformationAmountMaxValue.push(list[i].measuringSpotDifference);
                            cumulativeMaxValue.push(list[i].measuringSpotAccumulationValue);
                        }

                        deformationAmountMaxValue.sort(function (a, b) {
                            return Math.abs(a) - Math.abs(b);
                        });

                        cumulativeMaxValue.sort(function (a, b) {
                            return Math.abs(a) - Math.abs(b);
                        });

                        var maxValue = '<tr align="center"><td  colspan="5">最大值</td><td><font style="color:red;">' + deformationAmountMaxValue[deformationAmountMaxValue.length - 1] + '</font></td><td><font style="color:red;">' + cumulativeMaxValue[cumulativeMaxValue.length - 1] + '</font></td><td></td></tr>';
                        var remarks = ' <tr align="center"><td  colspan="8">备注：' + mapData.remarks + '</td> </tr>'
                        var img = ' <tr align="center"><td  colspan="8"><input type="file" name="file" id="file" accept="image/*" onchange="imgChange(this);"/> <!--文件上传选择按钮--> <img id="imghead" src="C:\Users\86132\Desktop\u=1042594109,1865981201&fm=26&gp=0.jpg"/> <!--图片显示位置--> </td></tr>'
                        tableView = tableView + tableData + maxValue + remarks + img + '</table>';

                        $("#content").append(tableView);

                    }
                }

            }
        });


        /*$.ajax({
            url:"/system/report/getData?list="+measuringSpotList, //请求的url地址
            dataType:"json", //返回格式为json
            async:true,//请求是否异步，默认为异步，这也是ajax重要特性
            //data:{"list":measuringSpotList}, //参数值
            type:"GET", //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(req){
                //请求成功时处理
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });*/

        // measuringSpotList = null;

    }

    layui.use(['tree', 'util'], function () {
        var tree = layui.tree
            , layer = layui.layer
            , util = layui.util,
            $ = layui.jquery;


        $.ajax({
            url: "/system/report/list",
            success: function (data) {
                tree.render({
                    elem: '#test13'
                    , data: data.data
                    , showLine: false  //是否开启连接线
                    , click: function (obj) {

                        if (obj.data.title == '检测数据') {
                            layer.open({
                                type: 2,
                                title: '测点选择',
                                shadeClose: true,
                                maxmin: true,
                                area: ['800px', '540px'],
                                /* content: '/system/report/measuringSpotTree' //这里content是一个普通的String*/
                                content: ['/system/report/measuringSpotTree', 'no']
                            });
                        } else {

                            var div = '<div class="t_content">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</div>';
                            var treeData = $("#tree").val;
                            treeData = layui.jquery('input[name= tree]').val()
                            $("#content").append(treeData);
                        }


                    }
                });
            }
        });
//无连接线风格

    });
</script>
<script>
    $(function () {
        //$("#file").hide();
        $("input[type='button']").click(function (event) {

            /*var t =  $("#content");
            //var  content =   $("#content")[0].innerText;
              var  content =   $("#content")[0].innerHTML;
              console.log(content);
              var test = document.getElementsByTagName('html')[0].innerHTML;
              $.post("/system/report/test",{test:content},function(result){
                  $("span").html(result);
              });*/

            $("#word").wordExport('word文档');
        });

    })
</script>


<div class="layui-layer-move"></div>
</body>
</html>
<!--

<table border="1" width="600">
    <tr align="center">
        <td colspan="2">工程名称</td>
        <td colspan="6">成都轨道交通8号线一期工程庆安站附属</td>
    </tr>
    <tr align="center">
        <td colspan="2">施工单位</td>
        <td colspan="2">中铁一局</td>
        <td colspan="2">检测项目</td>
        <td colspan="2">地表沉降</td>
    </tr>
    <tr align="center">
        <td colspan="2">监理单位</td>
        <td colspan="2">上海建科工程咨询有限公司</td>
        <td colspan="2">上次观测日期</td>
        <td colspan="2">2019-7-31</td>
    </tr>
    <tr align="center">
        <td colspan="2">仪器规格</td>
        <td colspan="2">Trimble DiNi03/738881</td>
        <td colspan="2">本次观测日期</td>
        <td colspan="2">2019-8-1</td>
    </tr>
    <tr align="center">
        <td rowspan="3">检测项目</td>
        <td rowspan="2">测点编号</td>
        <td >初始高程</td>
        <td>上次高程</td>
        <td>本次高程</td>
        <td >单次变形量</td>
        <td>累计值</td>
        <td rowspan="3">初测日期</td>

    </tr>
    <tr align="center">
        <td>(mm)</td>
        <td>(mm)</td>
        <td>(mm)</td>
        <td>(mm)</td>
        <td>(mm)</td>
    </tr>
    <tr align="center">
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td>4</td>
        <td>5</td>
        <td>6</td>
    </tr>
    <tr align="center">
        <td  colspan="5">最大值</td>
        <td>5</td>
        <td>6</td>
        <td></td>
    </tr>
    <tr align="center">
        <td  colspan="8">备注：1111111111111111111111111111111111111111111111111111</td>
    </tr>
</table>-->